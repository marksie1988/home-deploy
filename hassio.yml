---

- hosts: hassio
  roles:
    - motd
    - role: docker
      become: true
    - role: hassio
      become: true
    # - webhook

  tasks:
    - name: Pause until a Hassio is reachable from this host
      uri:
        url: "http://127.0.0.1:8123/"
        method: GET
        follow_redirects: all
        return_content: true
      register: _result
      until: _result.content.find('Preparing') == -1
      retries: 180 # 180 * 5 seconds = 15mins (60*60/5)
      delay: 5 # Every 5 seconds
      become: true

    - name: Install Addons
      hassio_addons:
        state: present
        name: "{{ item }}"
      with_items:
        - grafana
        - core_mosquitto
        - core_deconz
      become: true
      register: _result

    - name: Show Addons
      debug:
        var: _result
